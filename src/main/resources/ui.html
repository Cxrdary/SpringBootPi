<html>
    <body onload="doneLoading()">
        <h2>WebSocket Test</h2>
        <div>
            <input type="button" id="connectBtn" value="CONNECT" onclick="connect()" />
        </div>
        <div id="controls" style="display:none;">
            <div>
                <input type="range" min="0" max="255" value="255" id="sliderR" oninput="RGB.R=parseInt(value);displayValues()">
                <label id="labelR"></label>
            </div>
            <div>
                <input type="range" min="0" max="255" value="255" id="sliderG" oninput="RGB.G=parseInt(value);displayValues()">
                <label id="labelG"></label>
            </div>
            <div>
                <input type="range" min="0" max="255" value="255" id="sliderB" oninput="RGB.B=parseInt(value);displayValues()">
                <label id="labelB"></label>
            </div>
        </div>
        <div id="output">
            <h2>Output</h2>
        </div>
    </body>
    <script type="text/javascript">
                var stored = {};

                var RGB = {R:255,G:255,B:255};


                var webSocket;
                var output = document.getElementById("output");
                var connectBtn = document.getElementById("connectBtn");
                var sendBtn = document.getElementById("sendBtn");
                var wsUrl = (location.protocol == "https:" ? "wss://" : "ws://") + location.hostname + (location.port ? ':'+location.port: '') + "/websocket/toUpper";

                function connect() {
                  // open the connection if one does not exist
                  if (webSocket !== undefined
                    && webSocket.readyState !== WebSocket.CLOSED) {
                    return;
                  }

                  updateOutput("Trying to establish a WebSocket connection to <code>" + wsUrl + "</code>");

                  // Create a websocket
                  webSocket = new WebSocket(wsUrl);

                  webSocket.onopen = function(event) {
                    updateOutput("Connected!");
                    connectBtn.disabled = true;
                    sendBtn.disabled = false;
                  };

                  webSocket.onmessage = function(event) {
                    updateOutput(event.data);
                  };

                  webSocket.onclose = function(event) {
                    updateOutput("Connection Closed");
                    connectBtn.disabled = false;
                    sendBtn.disabled = true;
                    document.getElementById("controls").style.display = "none";
                  };

                  document.getElementById("controls").style.display = "initial";


                  setInterval(() => {
                        if(stored["RGB"] != JSON.stringify(RGB)) {
                            stored["RGB"] = JSON.stringify(RGB);
                            let wmsg = `RGB{${RGB.R.toString(16).padStart(2, '0')}${RGB.G.toString(16).padStart(2, '0')}${RGB.B.toString(16).padStart(2, '0')}}`;
                            console.log(wmsg);
                            send(wmsg);
                        }
                    }, 1000);
                }

                function send(text) {
                  webSocket.send(text);
                }

                function closeSocket() {
                  webSocket.close();
                }

                function updateOutput(text) {
                  output.innerHTML += "<br/>" + text;
                }

                function doneLoading() {
                    //connect();

                    //send(text)
                    updateOutput("Loaded!");
                }

                function displayValues() {
                    document.getElementById("labelR").innerText = `red: ${RGB.R}`;
                    document.getElementById("labelG").innerText = `green: ${RGB.G}`;
                    document.getElementById("labelB").innerText = `blue: ${RGB.B}`;
                    document.body.style.backgroundColor = `rgb(${RGB.R},${RGB.G},${RGB.B})`
                }

var console=(function(oldCons){
    return {
        log: function(text){
            oldCons.log(text);
            // Your code
            updateOutput(`log : ${text}`);
        },
        info: function (text) {
            oldCons.info(text);
            // Your code
            updateOutput(`info: ${text}`);
        },
        warn: function (text) {
            oldCons.warn(text);
            // Your code
            updateOutput(`warn: ${text}`);
        },
        error: function (text) {
            oldCons.error(text);
            // Your code
            updateOutput(`err : ${text}`);
        }
    };
}(window.console));

//Then redefine the old console
window.console = console;
    </script>
</html>